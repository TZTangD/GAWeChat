{"version":3,"file":"sidebar-nav.component.js","sourceRoot":"","sources":["../../../.ng_build/abc/sidebar-nav/sidebar-nav.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, ElementRef, Renderer2, Inject, OnInit, OnDestroy, HostListener, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport { MenuService, Menu, SettingsService } from '@delon/theme';\r\n\r\nconst SHOWCLS = 'nav-floating-show';\r\nconst FLOATINGCLS = 'nav-floating';\r\n\r\n@Component({\r\n    selector: 'sidebar-nav',\r\n    templateUrl: './sidebar-nav.component.html',\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n    preserveWhitespaces: false\r\n})\r\nexport class SidebarNavComponent implements OnInit, OnDestroy {\r\n\r\n    private rootEl: HTMLDivElement;\r\n    private floatingEl: HTMLDivElement;\r\n    private bodyEl: HTMLBodyElement;\r\n    list: Menu[] = [];\r\n    private change$: Subscription;\r\n\r\n    constructor(\r\n        private menuSrv: MenuService,\r\n        public settings: SettingsService,\r\n        private router: Router,\r\n        el: ElementRef,\r\n        private render: Renderer2,\r\n        private cd: ChangeDetectorRef,\r\n        @Inject(DOCUMENT) private doc: any) {\r\n        this.rootEl = el.nativeElement as HTMLDivElement;\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.bodyEl = this.doc.querySelector('body');\r\n        this.menuSrv.openedByUrl(this.router.url);\r\n        this.genFloatingContainer();\r\n        this.change$ = <any>this.menuSrv.change.subscribe(res => {\r\n            this.list = res;\r\n            this.cd.detectChanges();\r\n        });\r\n    }\r\n\r\n    private floatingAreaClickHandle(e: MouseEvent) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        if (this.settings.layout.collapsed !== true) {\r\n            return;\r\n        }\r\n        const linkNode = (e.target as Element);\r\n        if (linkNode.nodeName !== 'A') {\r\n            return;\r\n        }\r\n        let url: string = linkNode.getAttribute('href');\r\n        if (url) {\r\n            if (url.startsWith('#')) url = url.slice(1);\r\n            this.router.navigateByUrl(url);\r\n        }\r\n        this.hideAll();\r\n        return false;\r\n    }\r\n\r\n    genFloatingContainer() {\r\n        if (this.floatingEl) {\r\n            this.floatingEl.remove();\r\n            this.floatingEl.removeEventListener('click', this.floatingAreaClickHandle.bind(this));\r\n        }\r\n        this.floatingEl = this.render.createElement('div');\r\n        this.floatingEl.classList.add(FLOATINGCLS + '-container');\r\n        this.floatingEl.addEventListener('click', this.floatingAreaClickHandle.bind(this), false);\r\n        this.bodyEl.appendChild(this.floatingEl);\r\n    }\r\n\r\n    private genSubNode(linkNode: HTMLLinkElement, item: Menu): HTMLUListElement {\r\n        const id = `_sidebar-nav-${item.__id}`;\r\n        let node = this.floatingEl.querySelector('#' + id) as HTMLUListElement;\r\n        if (node) {\r\n            return node;\r\n        }\r\n        node = linkNode.nextElementSibling.cloneNode(true) as HTMLUListElement;\r\n        node.id = id;\r\n        node.classList.add(FLOATINGCLS);\r\n        node.addEventListener('mouseleave', () => {\r\n            node.classList.remove(SHOWCLS);\r\n        }, false);\r\n        this.floatingEl.appendChild(node);\r\n        return node;\r\n    }\r\n\r\n    private hideAll() {\r\n        const allNode = this.floatingEl.querySelectorAll('.' + FLOATINGCLS);\r\n        for (let i = 0; i < allNode.length; i++) {\r\n            allNode[i].classList.remove(SHOWCLS);\r\n        }\r\n    }\r\n\r\n    // calculate the node position values.\r\n    private calPos(linkNode: HTMLLinkElement, node: HTMLUListElement) {\r\n        const rect = linkNode.getBoundingClientRect();\r\n        // bug: https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/14721015/\r\n        const scrollTop = Math.max(this.doc.documentElement.scrollTop, this.bodyEl.scrollTop);\r\n        const top = rect.top + scrollTop,\r\n              left = rect.right + 5;\r\n        node.style.top = `${top}px`;\r\n        node.style.left = `${left}px`;\r\n    }\r\n\r\n    showSubMenu(e: MouseEvent, item: Menu) {\r\n        if (this.settings.layout.collapsed !== true) {\r\n            return;\r\n        }\r\n        e.preventDefault();\r\n        const linkNode = (e.target as Element);\r\n        if (linkNode.nodeName !== 'A') {\r\n            return;\r\n        }\r\n        const subNode = this.genSubNode(linkNode as HTMLLinkElement, item);\r\n        this.hideAll();\r\n        subNode.classList.add(SHOWCLS);\r\n        this.calPos(linkNode as HTMLLinkElement, subNode);\r\n    }\r\n\r\n    toggleOpen(item: Menu) {\r\n        this.menuSrv.visit((i, p) => {\r\n            if (i !== item) i._open = false;\r\n        });\r\n        let pItem = item.__parent;\r\n        while (pItem) {\r\n            pItem._open = true;\r\n            pItem = pItem.__parent;\r\n        }\r\n        item._open = !item._open;\r\n        this.cd.markForCheck();\r\n    }\r\n\r\n    @HostListener('document:click', ['$event.target'])\r\n    onClick() {\r\n        this.hideAll();\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this.change$) this.change$.unsubscribe();\r\n    }\r\n}\r\n"]}