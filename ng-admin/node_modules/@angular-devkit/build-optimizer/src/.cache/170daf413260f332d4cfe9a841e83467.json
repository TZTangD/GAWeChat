{"remainingRequest":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js??ref--3-1!D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\ng2-file-upload\\file-upload\\file-uploader.class.js","dependencies":[{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\ng2-file-upload\\file-upload\\file-uploader.class.js","mtime":1511630168000},{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":0},{"path":"D:\\mygit\\HCWeChat\\ng-admin\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js","mtime":1519266497000}],"contextDependencies":[],"result":["\"use strict\";\r\nvar core_1 = require(\"@angular/core\");\r\nvar file_like_object_class_1 = require(\"./file-like-object.class\");\r\nvar file_item_class_1 = require(\"./file-item.class\");\r\nvar file_type_class_1 = require(\"./file-type.class\");\r\nfunction isFile(value) {\r\n    return (File && value instanceof File);\r\n}\r\nvar FileUploader = /*@__PURE__*/ (function () {\r\n    function FileUploader(options) {\r\n        this.isUploading = false;\r\n        this.queue = [];\r\n        this.progress = 0;\r\n        this._nextIndex = 0;\r\n        this.options = {\r\n            autoUpload: false,\r\n            isHTML5: true,\r\n            filters: [],\r\n            removeAfterUpload: false,\r\n            disableMultipart: false,\r\n            formatDataFunction: function (item) { return item._file; },\r\n            formatDataFunctionIsAsync: false\r\n        };\r\n        this.setOptions(options);\r\n        this.response = new core_1.EventEmitter();\r\n    }\r\n    FileUploader.prototype.setOptions = function (options) {\r\n        this.options = Object.assign(this.options, options);\r\n        this.authToken = this.options.authToken;\r\n        this.authTokenHeader = this.options.authTokenHeader || 'Authorization';\r\n        this.autoUpload = this.options.autoUpload;\r\n        this.options.filters.unshift({ name: 'queueLimit', fn: this._queueLimitFilter });\r\n        if (this.options.maxFileSize) {\r\n            this.options.filters.unshift({ name: 'fileSize', fn: this._fileSizeFilter });\r\n        }\r\n        if (this.options.allowedFileType) {\r\n            this.options.filters.unshift({ name: 'fileType', fn: this._fileTypeFilter });\r\n        }\r\n        if (this.options.allowedMimeType) {\r\n            this.options.filters.unshift({ name: 'mimeType', fn: this._mimeTypeFilter });\r\n        }\r\n        for (var i = 0; i < this.queue.length; i++) {\r\n            this.queue[i].url = this.options.url;\r\n        }\r\n    };\r\n    FileUploader.prototype.addToQueue = function (files, options, filters) {\r\n        var _this = this;\r\n        var list = [];\r\n        for (var _i = 0, files_1 = files; _i < files_1.length; _i++) {\r\n            var file = files_1[_i];\r\n            list.push(file);\r\n        }\r\n        var arrayOfFilters = this._getFilters(filters);\r\n        var count = this.queue.length;\r\n        var addedFileItems = [];\r\n        list.map(function (some) {\r\n            if (!options) {\r\n                options = _this.options;\r\n            }\r\n            var temp = new file_like_object_class_1.FileLikeObject(some);\r\n            if (_this._isValidFile(temp, arrayOfFilters, options)) {\r\n                var fileItem = new file_item_class_1.FileItem(_this, some, options);\r\n                addedFileItems.push(fileItem);\r\n                _this.queue.push(fileItem);\r\n                _this._onAfterAddingFile(fileItem);\r\n            }\r\n            else {\r\n                var filter = arrayOfFilters[_this._failFilterIndex];\r\n                _this._onWhenAddingFileFailed(temp, filter, options);\r\n            }\r\n        });\r\n        if (this.queue.length !== count) {\r\n            this._onAfterAddingAll(addedFileItems);\r\n            this.progress = this._getTotalProgress();\r\n        }\r\n        this._render();\r\n        if (this.options.autoUpload) {\r\n            this.uploadAll();\r\n        }\r\n    };\r\n    FileUploader.prototype.removeFromQueue = function (value) {\r\n        var index = this.getIndexOfItem(value);\r\n        var item = this.queue[index];\r\n        if (item.isUploading) {\r\n            item.cancel();\r\n        }\r\n        this.queue.splice(index, 1);\r\n        this.progress = this._getTotalProgress();\r\n    };\r\n    FileUploader.prototype.clearQueue = function () {\r\n        while (this.queue.length) {\r\n            this.queue[0].remove();\r\n        }\r\n        this.progress = 0;\r\n    };\r\n    FileUploader.prototype.uploadItem = function (value) {\r\n        var index = this.getIndexOfItem(value);\r\n        var item = this.queue[index];\r\n        var transport = this.options.isHTML5 ? '_xhrTransport' : '_iframeTransport';\r\n        item._prepareToUploading();\r\n        if (this.isUploading) {\r\n            return;\r\n        }\r\n        this.isUploading = true;\r\n        this[transport](item);\r\n    };\r\n    FileUploader.prototype.cancelItem = function (value) {\r\n        var index = this.getIndexOfItem(value);\r\n        var item = this.queue[index];\r\n        var prop = this.options.isHTML5 ? item._xhr : item._form;\r\n        if (item && item.isUploading) {\r\n            prop.abort();\r\n        }\r\n    };\r\n    FileUploader.prototype.uploadAll = function () {\r\n        var items = this.getNotUploadedItems().filter(function (item) { return !item.isUploading; });\r\n        if (!items.length) {\r\n            return;\r\n        }\r\n        items.map(function (item) { return item._prepareToUploading(); });\r\n        items[0].upload();\r\n    };\r\n    FileUploader.prototype.cancelAll = function () {\r\n        var items = this.getNotUploadedItems();\r\n        items.map(function (item) { return item.cancel(); });\r\n    };\r\n    FileUploader.prototype.isFile = function (value) {\r\n        return isFile(value);\r\n    };\r\n    FileUploader.prototype.isFileLikeObject = function (value) {\r\n        return value instanceof file_like_object_class_1.FileLikeObject;\r\n    };\r\n    FileUploader.prototype.getIndexOfItem = function (value) {\r\n        return typeof value === 'number' ? value : this.queue.indexOf(value);\r\n    };\r\n    FileUploader.prototype.getNotUploadedItems = function () {\r\n        return this.queue.filter(function (item) { return !item.isUploaded; });\r\n    };\r\n    FileUploader.prototype.getReadyItems = function () {\r\n        return this.queue\r\n            .filter(function (item) { return (item.isReady && !item.isUploading); })\r\n            .sort(function (item1, item2) { return item1.index - item2.index; });\r\n    };\r\n    FileUploader.prototype.destroy = function () {\r\n        return void 0;\r\n    };\r\n    FileUploader.prototype.onAfterAddingAll = function (fileItems) {\r\n        return { fileItems: fileItems };\r\n    };\r\n    FileUploader.prototype.onBuildItemForm = function (fileItem, form) {\r\n        return { fileItem: fileItem, form: form };\r\n    };\r\n    FileUploader.prototype.onAfterAddingFile = function (fileItem) {\r\n        return { fileItem: fileItem };\r\n    };\r\n    FileUploader.prototype.onWhenAddingFileFailed = function (item, filter, options) {\r\n        return { item: item, filter: filter, options: options };\r\n    };\r\n    FileUploader.prototype.onBeforeUploadItem = function (fileItem) {\r\n        return { fileItem: fileItem };\r\n    };\r\n    FileUploader.prototype.onProgressItem = function (fileItem, progress) {\r\n        return { fileItem: fileItem, progress: progress };\r\n    };\r\n    FileUploader.prototype.onProgressAll = function (progress) {\r\n        return { progress: progress };\r\n    };\r\n    FileUploader.prototype.onSuccessItem = function (item, response, status, headers) {\r\n        return { item: item, response: response, status: status, headers: headers };\r\n    };\r\n    FileUploader.prototype.onErrorItem = function (item, response, status, headers) {\r\n        return { item: item, response: response, status: status, headers: headers };\r\n    };\r\n    FileUploader.prototype.onCancelItem = function (item, response, status, headers) {\r\n        return { item: item, response: response, status: status, headers: headers };\r\n    };\r\n    FileUploader.prototype.onCompleteItem = function (item, response, status, headers) {\r\n        return { item: item, response: response, status: status, headers: headers };\r\n    };\r\n    FileUploader.prototype.onCompleteAll = function () {\r\n        return void 0;\r\n    };\r\n    FileUploader.prototype._mimeTypeFilter = function (item) {\r\n        return !(this.options.allowedMimeType && this.options.allowedMimeType.indexOf(item.type) === -1);\r\n    };\r\n    FileUploader.prototype._fileSizeFilter = function (item) {\r\n        return !(this.options.maxFileSize && item.size > this.options.maxFileSize);\r\n    };\r\n    FileUploader.prototype._fileTypeFilter = function (item) {\r\n        return !(this.options.allowedFileType &&\r\n            this.options.allowedFileType.indexOf(file_type_class_1.FileType.getMimeClass(item)) === -1);\r\n    };\r\n    FileUploader.prototype._onErrorItem = function (item, response, status, headers) {\r\n        item._onError(response, status, headers);\r\n        this.onErrorItem(item, response, status, headers);\r\n    };\r\n    FileUploader.prototype._onCompleteItem = function (item, response, status, headers) {\r\n        item._onComplete(response, status, headers);\r\n        this.onCompleteItem(item, response, status, headers);\r\n        var nextItem = this.getReadyItems()[0];\r\n        this.isUploading = false;\r\n        if (nextItem) {\r\n            nextItem.upload();\r\n            return;\r\n        }\r\n        this.onCompleteAll();\r\n        this.progress = this._getTotalProgress();\r\n        this._render();\r\n    };\r\n    FileUploader.prototype._headersGetter = function (parsedHeaders) {\r\n        return function (name) {\r\n            if (name) {\r\n                return parsedHeaders[name.toLowerCase()] || void 0;\r\n            }\r\n            return parsedHeaders;\r\n        };\r\n    };\r\n    FileUploader.prototype._xhrTransport = function (item) {\r\n        var _this = this;\r\n        var that = this;\r\n        var xhr = item._xhr = new XMLHttpRequest();\r\n        var sendable;\r\n        this._onBeforeUploadItem(item);\r\n        if (typeof item._file.size !== 'number') {\r\n            throw new TypeError('The file specified is no longer valid');\r\n        }\r\n        if (!this.options.disableMultipart) {\r\n            sendable = new FormData();\r\n            this._onBuildItemForm(item, sendable);\r\n            var appendFile = function () { return sendable.append(item.alias, item._file, item.file.name); };\r\n            if (!this.options.parametersBeforeFiles) {\r\n                appendFile();\r\n            }\r\n            // For AWS, Additional Parameters must come BEFORE Files\r\n            if (this.options.additionalParameter !== undefined) {\r\n                Object.keys(this.options.additionalParameter).forEach(function (key) {\r\n                    var paramVal = _this.options.additionalParameter[key];\r\n                    // Allow an additional parameter to include the filename\r\n                    if (typeof paramVal === 'string' && paramVal.indexOf('{{file_name}}') >= 0) {\r\n                        paramVal = paramVal.replace('{{file_name}}', item.file.name);\r\n                    }\r\n                    sendable.append(key, paramVal);\r\n                });\r\n            }\r\n            if (this.options.parametersBeforeFiles) {\r\n                appendFile();\r\n            }\r\n        }\r\n        else {\r\n            sendable = this.options.formatDataFunction(item);\r\n        }\r\n        xhr.upload.onprogress = function (event) {\r\n            var progress = Math.round(event.lengthComputable ? event.loaded * 100 / event.total : 0);\r\n            _this._onProgressItem(item, progress);\r\n        };\r\n        xhr.onload = function () {\r\n            var headers = _this._parseHeaders(xhr.getAllResponseHeaders());\r\n            var response = _this._transformResponse(xhr.response, headers);\r\n            var gist = _this._isSuccessCode(xhr.status) ? 'Success' : 'Error';\r\n            var method = '_on' + gist + 'Item';\r\n            _this[method](item, response, xhr.status, headers);\r\n            _this._onCompleteItem(item, response, xhr.status, headers);\r\n        };\r\n        xhr.onerror = function () {\r\n            var headers = _this._parseHeaders(xhr.getAllResponseHeaders());\r\n            var response = _this._transformResponse(xhr.response, headers);\r\n            _this._onErrorItem(item, response, xhr.status, headers);\r\n            _this._onCompleteItem(item, response, xhr.status, headers);\r\n        };\r\n        xhr.onabort = function () {\r\n            var headers = _this._parseHeaders(xhr.getAllResponseHeaders());\r\n            var response = _this._transformResponse(xhr.response, headers);\r\n            _this._onCancelItem(item, response, xhr.status, headers);\r\n            _this._onCompleteItem(item, response, xhr.status, headers);\r\n        };\r\n        xhr.open(item.method, item.url, true);\r\n        xhr.withCredentials = item.withCredentials;\r\n        if (this.options.headers) {\r\n            for (var _i = 0, _a = this.options.headers; _i < _a.length; _i++) {\r\n                var header = _a[_i];\r\n                xhr.setRequestHeader(header.name, header.value);\r\n            }\r\n        }\r\n        if (item.headers.length) {\r\n            for (var _b = 0, _c = item.headers; _b < _c.length; _b++) {\r\n                var header = _c[_b];\r\n                xhr.setRequestHeader(header.name, header.value);\r\n            }\r\n        }\r\n        if (this.authToken) {\r\n            xhr.setRequestHeader(this.authTokenHeader, this.authToken);\r\n        }\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == XMLHttpRequest.DONE) {\r\n                that.response.emit(xhr.responseText);\r\n            }\r\n        };\r\n        if (this.options.formatDataFunctionIsAsync) {\r\n            sendable.then(function (result) { return xhr.send(JSON.stringify(result)); });\r\n        }\r\n        else {\r\n            xhr.send(sendable);\r\n        }\r\n        this._render();\r\n    };\r\n    FileUploader.prototype._getTotalProgress = function (value) {\r\n        if (value === void 0) {\r\n            value = 0;\r\n        }\r\n        if (this.options.removeAfterUpload) {\r\n            return value;\r\n        }\r\n        var notUploaded = this.getNotUploadedItems().length;\r\n        var uploaded = notUploaded ? this.queue.length - notUploaded : this.queue.length;\r\n        var ratio = 100 / this.queue.length;\r\n        var current = value * ratio / 100;\r\n        return Math.round(uploaded * ratio + current);\r\n    };\r\n    FileUploader.prototype._getFilters = function (filters) {\r\n        if (!filters) {\r\n            return this.options.filters;\r\n        }\r\n        if (Array.isArray(filters)) {\r\n            return filters;\r\n        }\r\n        if (typeof filters === 'string') {\r\n            var names_1 = filters.match(/[^\\s,]+/g);\r\n            return this.options.filters\r\n                .filter(function (filter) { return names_1.indexOf(filter.name) !== -1; });\r\n        }\r\n        return this.options.filters;\r\n    };\r\n    FileUploader.prototype._render = function () {\r\n        return void 0;\r\n    };\r\n    FileUploader.prototype._queueLimitFilter = function () {\r\n        return this.options.queueLimit === undefined || this.queue.length < this.options.queueLimit;\r\n    };\r\n    FileUploader.prototype._isValidFile = function (file, filters, options) {\r\n        var _this = this;\r\n        this._failFilterIndex = -1;\r\n        return !filters.length ? true : filters.every(function (filter) {\r\n            _this._failFilterIndex++;\r\n            return filter.fn.call(_this, file, options);\r\n        });\r\n    };\r\n    FileUploader.prototype._isSuccessCode = function (status) {\r\n        return (status >= 200 && status < 300) || status === 304;\r\n    };\r\n    FileUploader.prototype._transformResponse = function (response, headers) {\r\n        return response;\r\n    };\r\n    FileUploader.prototype._parseHeaders = function (headers) {\r\n        var parsed = {};\r\n        var key;\r\n        var val;\r\n        var i;\r\n        if (!headers) {\r\n            return parsed;\r\n        }\r\n        headers.split('\\n').map(function (line) {\r\n            i = line.indexOf(':');\r\n            key = line.slice(0, i).trim().toLowerCase();\r\n            val = line.slice(i + 1).trim();\r\n            if (key) {\r\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\r\n            }\r\n        });\r\n        return parsed;\r\n    };\r\n    FileUploader.prototype._onWhenAddingFileFailed = function (item, filter, options) {\r\n        this.onWhenAddingFileFailed(item, filter, options);\r\n    };\r\n    FileUploader.prototype._onAfterAddingFile = function (item) {\r\n        this.onAfterAddingFile(item);\r\n    };\r\n    FileUploader.prototype._onAfterAddingAll = function (items) {\r\n        this.onAfterAddingAll(items);\r\n    };\r\n    FileUploader.prototype._onBeforeUploadItem = function (item) {\r\n        item._onBeforeUpload();\r\n        this.onBeforeUploadItem(item);\r\n    };\r\n    FileUploader.prototype._onBuildItemForm = function (item, form) {\r\n        item._onBuildForm(form);\r\n        this.onBuildItemForm(item, form);\r\n    };\r\n    FileUploader.prototype._onProgressItem = function (item, progress) {\r\n        var total = this._getTotalProgress(progress);\r\n        this.progress = total;\r\n        item._onProgress(progress);\r\n        this.onProgressItem(item, progress);\r\n        this.onProgressAll(total);\r\n        this._render();\r\n    };\r\n    FileUploader.prototype._onSuccessItem = function (item, response, status, headers) {\r\n        item._onSuccess(response, status, headers);\r\n        this.onSuccessItem(item, response, status, headers);\r\n    };\r\n    FileUploader.prototype._onCancelItem = function (item, response, status, headers) {\r\n        item._onCancel(response, status, headers);\r\n        this.onCancelItem(item, response, status, headers);\r\n    };\r\n    return FileUploader;\r\n}());\r\nexports.FileUploader = FileUploader;\r\n",null]}